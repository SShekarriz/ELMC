---
title: "paper figures"
output: html_document
date: "2025-07-13"
---

```{r}

library(tidyverse)
library(ggpubr)
library(cowplot)
library(ape)
library(ggtree)      # For tree visualization and gheatmap
library(treeio)      # For reading tree files (e.g., Newick format)
library(aplot) # For aligning plots

library(forcats)
library(pheatmap)

#load functions
source('./functions.R')

```

## microbial profile

```{r}

profiler.fam(metaphlan = "../data/clean/speciesAbund.txt",
             mapfile = "../data/clean/mapfile.txt")
ggsave("../figs/Species_profile.pdf", width = 18, height = 14, units = "cm")

```

## microbial diversity

```{r}

vis.shannon(Shannon = "../data/clean/diversity_shannon.txt",
            Mapfile = "../data/clean/mapfile.txt")
ggsave("../figs/diversity_shannon.pdf", width = 12, 
       height = 10, units = "cm")

```

## microbial distance

```{r}

vis.pairBray(Paired_bray = "../data/clean/paired_bray.txt",
             Mapfile = "../data/clean/mapfile.txt")
ggsave("../figs/diversity_pairdBray.pdf", width = 15, 
       height = 10, units = "cm")

```


## Count number of colonization per feature

```{r}

CountFig(ftype = "Bin")
ggsave("../figs/Bin_CF.pdf",
       width = 16, height = 10, 
       units = "cm")

```


```{r}

CountFig(ftype = "MAG")
ggsave("../figs/MAG_CF.pdf",
       width = 16, height = 10, 
       units = "cm")

```


```{r}

CountFig(ftype = "Species")
ggsave("../figs/Species_CF.pdf",
       width = 16, height = 10, 
       units = "cm")

```


```{r}

CountFig(ftype = "Gene")
ggsave("../figs/Gene_CF.pdf",
       width = 16, height = 10, 
       units = "cm")

```


## compare colonization within each feature

```{r}
# labels
BinQT <- read.csv("../data/clean/binQT.txt", sep = "\t")
BinQT %>% mutate(feature = paste0(BinLab)) %>%
  mutate(temp = gsub("_.*", "", feature)) %>%
  mutate(label = paste(label, gsub("Don", "", temp), sep = "")) %>%
  select(feature, label)-> BinQT
#
CompFeature(feature_c = "../data/clean/binCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") -> table

fig <- CompFig_pheatmap(table = table,
                 flabel = BinQT)
ggsave("../figs/Bin_pheatmap.pdf", plot = fig, width = 9, height = 11)

```


```{r}
# labels
BinQT <- read.csv("../data/clean/binQT.txt", sep = "\t")
BinQT %>% mutate(feature = paste0(BinLab)) %>%
  mutate(temp = gsub("_.*", "", feature)) %>%
  mutate(label = paste(label, gsub("Don", "", temp), sep = "")) %>%
  select(feature, label)-> BinQT
#
CompFeature(feature_c = "../data/clean/MAGCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") -> table

fig <- CompFig_pheatmap(table = table,
                 flabel = BinQT)
ggsave("../figs/MAG_pheatmap.pdf", plot = fig, width = 9, height = 9)

```





```{r}


CompFig(feature_c = "../data/clean/binCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") 


```





```{r}

CompFigWithTree(feature_c = "../data/clean/MAGCover.txt",
                cutoff_pres = 75,
                method = "Assembly",
                mapfile = "../data/clean/mapfile.txt",
                treeA_file = "../data/clean/MAGs_DonA.tree")


```










