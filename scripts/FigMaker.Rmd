---
title: "paper figures"
output: html_document
date: "2025-07-13"
---

```{r}

library(tidyverse)
library(ggpubr)
library(cowplot)
library(ape)
library(ggtree)      # For tree visualization and gheatmap
library(treeio)      # For reading tree files (e.g., Newick format)
library(aplot) # For aligning plots

library(forcats)
library(pheatmap)

#load functions
source('./functions.R')

```

## Bins

```{r}

CountFig(feature_c = "../data/clean/binCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt")

CountFig(feature_c = "../data/clean/binCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") +
  facet_grid(Donor~., space = "free", scales = "free")




```

```{r}

CompFig(feature_c = "../data/clean/binCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") 


```

## MAGs

```{r}

CountFig(feature_c = "../data/clean/MAGCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") 

```

```{r}

CompFig(feature_c = "../data/clean/MAGCover.txt",
           cutoff_pres = 75,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt")

```


```{r}

CompFigWithTree(feature_c = "../data/clean/MAGCover.txt",
                cutoff_pres = 75,
                method = "Assembly",
                mapfile = "../data/clean/mapfile.txt",
                treeA_file = "../data/clean/MAGs_DonA.tree")


```


```{r}

feature_c = "../data/clean/MAGCover.txt"
cutoff_pres = 75
method = "Assembly"
mapfile = "../data/clean/mapfile.txt"

  # DonorA
  donorA_feature <- DonFeature(feature_c = feature_c, donor = "DonA",
                               cutoff_pres = cutoff_pres, method = method)
  finalA_identity <- identColoniz(donor_feature = donorA_feature, 
                               cutoff_pres = cutoff_pres,
                               mapfile = mapfile) %>%
                    mutate(Donor = paste("DonorA"))
  # DonorB
  donorB_feature <- DonFeature(feature_c = feature_c, donor = "DonB",
                               cutoff_pres = cutoff_pres, method = method)
  finalB_identity <- identColoniz(donor_feature = donorB_feature, 
                                  cutoff_pres = cutoff_pres,
                                  mapfile = mapfile) %>%
                    mutate(Donor = paste("DonorB"))
  
  table <- finalA_identity %>%
    rbind(finalB_identity) 
  
  table %>%
    distinct(feature, Donor) -> test
  

```








```{r}

CompFigWithTree_pheatmap(feature_c = "../data/clean/MAGCover.txt",
                cutoff_pres = 75,
                method = "Assembly",
                mapfile = "../data/clean/mapfile.txt")


```



## Genes

```{r}

CountFig(feature_c = "../data/clean/geneCover.txt",
           cutoff_pres = 90,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") 

```

```{r}

CompFig(feature_c = "../data/clean/geneCover.txt",
           cutoff_pres = 90,
           method = "Assembly",
           mapfile = "../data/clean/mapfile.txt") 


```

## Species

```{r}

CountFig(feature_c = "../data/clean/speciesAbund.txt",
           cutoff_pres = 0.001,
           method = "Reads",
           mapfile = "../data/clean/mapfile.txt") 

```

```{r}

CompFig(feature_c = "../data/clean/speciesAbund.txt",
           cutoff_pres = 0.001,
           method = "Reads",
           mapfile = "../data/clean/mapfile.txt") 


```
